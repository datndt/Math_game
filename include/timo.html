<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luy·ªán Thi TIMO M·∫ßm Non (ƒêa D·∫°ng)</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #007bff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-bg: #f8f9fa;
            --dark-text: #343a40;
            --border-radius: 16px;
        }
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #eef5ff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: var(--dark-text);
        }
        .container {
            background-color: white;
            padding: 30px 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
            width: 95%;
            max-width: 800px;
            transition: all 0.3s ease;
        }

        /* --- M√†n h√¨nh b·∫Øt ƒë·∫ßu --- */
        #start-screen h1 { color: var(--primary-color); text-align: center; }
        #start-btn {
            background-color: var(--primary-color); color: white; border: none;
            padding: 15px 30px; font-size: 1.2rem; border-radius: 12px;
            cursor: pointer; width: 100%; margin-top: 20px; font-weight: 600;
        }
        #start-btn:hover { background-color: #0056b3; }

        /* --- M√†n h√¨nh game --- */
        #game-screen { display: none; }
        .game-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #progress-text { font-size: 1.2rem; font-weight: 700; color: var(--primary-color); }
        #score-text { font-size: 1.2rem; font-weight: 700; color: var(--success-color); }

        #question-area {
            background: var(--light-bg); border-radius: var(--border-radius);
            padding: 20px; margin: 20px 0; min-height: 100px;
            font-size: 1.3rem; line-height: 1.6; text-align: center;
        }
        #question-area strong { color: var(--danger-color); }
        /* TƒÉng k√≠ch th∆∞·ªõc Emoji cho d·ªÖ ƒë·∫øm */
        #emoji-display { font-size: 2.5rem; margin-top: 15px; letter-spacing: 0.2em; }
        
        #options-area { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .option-btn {
            background-color: white; border: 2px solid #ddd; border-radius: 12px;
            padding: 20px; font-size: 1.1rem; font-weight: 600; cursor: pointer;
            transition: all 0.2s ease; display: flex; align-items: center;
        }
        .option-btn:hover {
            border-color: var(--primary-color); color: var(--primary-color);
            transform: translateY(-3px); box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .option-btn.selected-correct {
            background-color: var(--success-color); border-color: var(--success-color);
            color: white; animation: bounce 0.5s;
        }
        .option-btn.selected-wrong {
            background-color: var(--danger-color); border-color: var(--danger-color);
            color: white; animation: shake 0.5s;
        }
        .option-label { font-weight: 700; margin-right: 10px; font-size: 1.2rem; }

        @keyframes bounce { 0%, 20%, 50%, 80%, 100% { transform: translateY(0); } 40% { transform: translateY(-10px); } 60% { transform: translateY(-5px); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); } 20%, 40%, 60%, 80% { transform: translateX(5px); } }
        
        /* M√†n h√¨nh k·∫øt th√∫c */
        #end-screen { display: none; text-align: center; }
        #end-screen h2 { color: var(--success-color); font-size: 2rem; }
        #end-score-text { font-size: 1.5rem; margin: 20px 0; }
        #restart-btn {
            background-color: var(--primary-color); color: white; border: none;
            padding: 15px 30px; font-size: 1.2rem; border-radius: 12px;
            cursor: pointer; margin-top: 20px; font-weight: 600;
        }
    </style>
</head>
<body>

<div class="container">
    <div id="start-screen">
        <h1>Luy·ªán Thi TIMO M·∫ßm Non</h1>
        <p>B√© s·∫Ω l√†m 10 c√¢u h·ªèi ng·∫´u nhi√™n thu·ªôc c√°c d·∫°ng ƒë·∫øm h√¨nh, t√¨m s·ªë, to√°n ƒë·ªë v√† t√¨m quy lu·∫≠t ƒë∆°n gi·∫£n.</p>
        <button id="start-btn">B·∫Øt ƒë·∫ßu l√†m b√†i!</button>
    </div>

    <div id="game-screen">
        <div class="game-header">
            <div id="progress-text">C√¢u 1 / 10</div>
            <div id="score-text">ƒêi·ªÉm: 0</div>
        </div>
        <hr>
        <div id="question-area"></div>
        <div id="options-area"></div>
    </div>
    
    <div id="end-screen">
        <h2>Ch√∫c m·ª´ng!</h2>
        <p id="end-score-text"></p>
        <button id="restart-btn">L√†m l·∫°i b√†i kh√°c</button>
    </div>
</div>

<script>
// --- DOM ELEMENTS ---
const startScreen = document.getElementById('start-screen');
const gameScreen = document.getElementById('game-screen');
const endScreen = document.getElementById('end-screen');
const startBtn = document.getElementById('start-btn');
const restartBtn = document.getElementById('restart-btn');
const progressText = document.getElementById('progress-text');
const scoreText = document.getElementById('score-text');
const questionArea = document.getElementById('question-area');
const optionsArea = document.getElementById('options-area');
const endScoreText = document.getElementById('end-score-text');

// --- H√ÄM H·ªñ TR·ª¢ ---
function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
function getRandomItem(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
}

//======================================================================
// PH·∫¶N 1: C√ÅC "C√îNG TH·ª®C" M·∫¶M NON (GENERATORS)
//======================================================================

// Nguy√™n li·ªáu cho c√°c c√¢u h·ªèi
const names = ["An", "B√¨nh", "C∆∞·ªùng", "D≈©ng", "Hoa", "Lan", "Mai"];
const items = ["c√°i k·∫πo", "qu·∫£ b√≥ng", "b√¥ng hoa", "quy·ªÉn v·ªü", "chi·∫øc b√°nh"];
const emojis = [
    { target: 'üçé', distractor: 'üçå' },
    { target: 'üê∂', distractor: 'üê±' },
    { target: 'üöó', distractor: 'üö≤' },
    { target: '‚òÄÔ∏è', distractor: 'üåô' }
];
const alphabet = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";

/**
 * T·∫°o 1 ƒë√°p √°n ƒë√∫ng v√† 3 ƒë√°p √°n nhi·ªÖu (d·∫°ng s·ªë)
 */
function generateNumericOptions(correctAnswer) {
    let options = [correctAnswer];
    while (options.length < 4) {
        let distractor = correctAnswer + getRandomInt(-2, 2);
        // ƒê·∫£m b·∫£o kh√¥ng tr√πng v√† kh√¥ng < 0
        if (distractor !== correctAnswer && distractor >= 0 && !options.includes(distractor)) {
            options.push(distractor);
        }
    }
    return shuffleArray(options.map(String)); // Tr·∫£ v·ªÅ m·∫£ng chu·ªói
}

// --- DANH S√ÅCH C√ÅC H√ÄM T·∫†O C√ÇU H·ªéI M·∫¶M NON ---

/**
 * D·∫†NG M·∫¶M NON 1: ƒê·∫æM H√åNH ·∫¢NH (D√ôNG EMOJI)
 * (Gi·ªëng Q1 ƒê·ªÅ MN)
 */
function generateCountingEmoji() {
    const { target, distractor } = getRandomItem(emojis);
    const correctCount = getRandomInt(3, 7);
    const distractorCount = getRandomInt(2, 4);
    
    let displayArray = [];
    for (let i = 0; i < correctCount; i++) displayArray.push(target);
    for (let i = 0; i < distractorCount; i++) displayArray.push(distractor);
    
    const questionText = `B√© h√£y ƒë·∫øm xem c√≥ bao nhi√™u ${target} nh√©?
        <div id="emoji-display">${shuffleArray(displayArray).join(' ')}</div>`;
    
    return {
        questionText: questionText,
        options: generateNumericOptions(correctCount),
        correctAnswer: String(correctCount)
    };
}

/**
 * D·∫†NG M·∫¶M NON 2: TO√ÅN ƒê·ªê C·ªòNG (S·ªê NH·ªé)
 * (Gi·ªëng Q12 ƒê·ªÅ s·ªë 1)
 */
function generateStoryAdd() {
    const name = getRandomItem(names);
    const item = getRandomItem(items);
    const num1 = getRandomInt(2, 5);
    const num2 = getRandomInt(1, 4);
    const correctAnswer = num1 + num2;
    
    const questionText = `B·∫°n <strong>${name}</strong> c√≥ <strong>${num1}</strong> ${item}. 
        M·∫π cho ${name} th√™m <strong>${num2}</strong> ${item} n·ªØa. 
        H·ªèi ${name} c√≥ t·∫•t c·∫£ bao nhi√™u ${item}?`;
        
    return {
        questionText: questionText,
        options: generateNumericOptions(correctAnswer),
        correctAnswer: String(correctAnswer)
    };
}

/**
 * D·∫†NG M·∫¶M NON 3: TO√ÅN ƒê·ªê TR·ª™ (S·ªê NH·ªé)
 */
function generateStorySubtract() {
    const name = getRandomItem(names);
    const item = getRandomItem(items);
    const num1 = getRandomInt(5, 9); // B·∫Øt ƒë·∫ßu v·ªõi s·ªë l·ªõn h∆°n
    const num2 = getRandomInt(1, 4); // Tr·ª´ ƒëi s·ªë nh·ªè h∆°n
    const correctAnswer = num1 - num2;
    
    const questionText = `B·∫°n <strong>${name}</strong> c√≥ <strong>${num1}</strong> ${item}. 
        ${name} ƒë√£ cho b·∫°n <strong>${num2}</strong> ${item}. 
        H·ªèi ${name} c√≤n l·∫°i bao nhi√™u ${item}?`;
        
    return {
        questionText: questionText,
        options: generateNumericOptions(correctAnswer),
        correctAnswer: String(correctAnswer)
    };
}

/**
 * D·∫†NG M·∫¶M NON 4: SO S√ÅNH S·ªê (L·ªöN NH·∫§T / NH·ªé NH·∫§T)
 * (Gi·ªëng Q14 ƒê·ªÅ s·ªë 1)
 */
function generateNumberCompare() {
    const type = (Math.random() > 0.5) ? 'l·ªõn nh·∫•t' : 'nh·ªè nh·∫•t';
    let numbers = [];
    while (numbers.length < 4) {
        let num = getRandomInt(1, 20);
        if (!numbers.includes(num)) {
            numbers.push(num);
        }
    }
    
    const correctAnswer = (type === 'l·ªõn nh·∫•t') ? Math.max(...numbers) : Math.min(...numbers);
    
    const questionText = `T√¨m s·ªë <strong>${type}</strong> trong c√°c s·ªë sau:
        <br><strong>${numbers.join(', ')}</strong>`;
        
    return {
        questionText: questionText,
        options: shuffleArray(numbers.map(String)), // C√°c l·ª±a ch·ªçn ch√≠nh l√† c√°c s·ªë ƒë√≥
        correctAnswer: String(correctAnswer)
    };
}

/**
 * D·∫†NG M·∫¶M NON 5: QUY LU·∫¨T CH·ªÆ C√ÅI
 * (Gi·ªëng Q3 ƒê·ªÅ MN: B, D, F, H,...)
 */
function generateLetterPattern() {
    const step = (Math.random() > 0.5) ? 1 : 2; // B∆∞·ªõc nh·∫£y 1 (A,B,C) ho·∫∑c 2 (A,C,E)
    const startIdx = getRandomInt(0, 10); // B·∫Øt ƒë·∫ßu t·ª´ A -> K
    
    const sequence = [
        alphabet[startIdx],
        alphabet[startIdx + step],
        alphabet[startIdx + (step * 2)]
    ];
    const correctAnswer = alphabet[startIdx + (step * 3)];
    
    let options = [correctAnswer];
    while (options.length < 4) {
        let distractorIdx = getRandomInt(startIdx, startIdx + 8);
        let distractor = alphabet[distractorIdx];
        if (!options.includes(distractor) && !sequence.includes(distractor)) {
            options.push(distractor);
        }
    }
    
    const questionText = `T√¨m ch·ªØ c√°i ti·∫øp theo trong d√£y:
        <br><strong>${sequence.join(', ')}, ___?</strong>`;
        
    return {
        questionText: questionText,
        options: shuffleArray(options),
        correctAnswer: correctAnswer
    };
}

//======================================================================
// PH·∫¶N 2: B·ªò M√ÅY T·∫†O B√ÄI KI·ªÇM TRA M·∫¶M NON
//======================================================================

// T·∫≠p h·ª£p T·∫§T C·∫¢ c√°c "c√¥ng th·ª©c" M·∫ßm non
const preschoolGenerators = [
    generateCountingEmoji,
    generateStoryAdd,
    generateStorySubtract,
    generateNumberCompare,
    generateLetterPattern,
    // Th√™m c√°c h√†m generator m·ªõi c·ªßa b·∫°n v√†o ƒë√¢y
    // V√≠ d·ª•, n·∫øu b·∫°n l√†m ƒë∆∞·ª£c b√†i to√°n c√¢n, h√£y th√™m: generateLogicBalance
];

let fullTest = [];
let currentQuestionIndex = 0;
let score = 0;
let answered = false;
const TOTAL_QUESTIONS = 10; // ƒê·∫∑t t·ªïng s·ªë c√¢u h·ªèi cho m·ªói b√†i test

/**
 * X√¢y d·ª±ng m·ªôt b√†i test ƒëa d·∫°ng
 * B·∫±ng c√°ch CH·ªåN NG·∫™U NHI√äN 10 "c√¥ng th·ª©c" t·ª´ kho
 */
function buildTest() {
    fullTest = [];
    
    for (let i = 0; i < TOTAL_QUESTIONS; i++) {
        // L·∫•y ng·∫´u nhi√™n m·ªôt "c√¥ng th·ª©c" t·ª´ trong kho
        const randomGenerator = getRandomItem(preschoolGenerators);
        
        // Ch·∫°y "c√¥ng th·ª©c" ƒë√≥ ƒë·ªÉ t·∫°o ra 1 c√¢u h·ªèi
        fullTest.push(randomGenerator());
    }
}

//======================================================================
// PH·∫¶N 3: LOGIC HI·ªÇN TH·ªä V√Ä CH∆†I GAME (Gi·ªØ nguy√™n)
//======================================================================

function startGame() {
    currentQuestionIndex = 0;
    score = 0;
    answered = false;
    
    buildTest(); // T·∫°o m·ªôt b·ªô ƒë·ªÅ m·ªõi
    
    startScreen.style.display = 'none';
    endScreen.style.display = 'none';
    gameScreen.style.display = 'block';
    
    scoreText.textContent = `ƒêi·ªÉm: 0`;
    loadQuestion();
}

function loadQuestion() {
    if (currentQuestionIndex >= fullTest.length) {
        endGame();
        return;
    }
    
    answered = false;
    const question = fullTest[currentQuestionIndex];
    
    progressText.textContent = `C√¢u ${currentQuestionIndex + 1} / ${TOTAL_QUESTIONS}`;
    questionArea.innerHTML = question.questionText; // D√πng innerHTML ƒë·ªÉ hi·ªÉn th·ªã <strong> v√† <div>
    
    optionsArea.innerHTML = '';
    const optionLabels = ['A', 'B', 'C', 'D'];
    
    question.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.classList.add('option-btn');
        button.dataset.answer = option; 
        
        button.innerHTML = `
            <span class="option-label">${optionLabels[index]}.</span>
            <span>${option}</span>
        `;
        
        button.addEventListener('click', () => checkAnswer(button));
        optionsArea.appendChild(button);
    });
}

function checkAnswer(selectedButton) {
    if (answered) return;
    answered = true;
    
    const selectedAnswer = selectedButton.dataset.answer;
    const correctAnswer = fullTest[currentQuestionIndex].correctAnswer;

    if (selectedAnswer === correctAnswer) {
        score++;
        scoreText.textContent = `ƒêi·ªÉm: ${score}`;
        selectedButton.classList.add('selected-correct');
    } else {
        selectedButton.classList.add('selected-wrong');
        Array.from(optionsArea.children).forEach(btn => {
            if (btn.dataset.answer === correctAnswer) {
                btn.classList.add('selected-correct');
            }
        });
    }
    
    setTimeout(() => {
        currentQuestionIndex++;
        loadQuestion();
    }, 1500);
}

function endGame() {
    gameScreen.style.display = 'none';
    endScreen.style.display = 'block';
    endScoreText.innerHTML = `B√© ƒë√£ ho√†n th√†nh b√†i thi v·ªõi s·ªë ƒëi·ªÉm: <strong>${score} / ${TOTAL_QUESTIONS}</strong>`;
}

// --- EVENT LISTENERS ---
startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', startGame);

</script>
</body>
</html>