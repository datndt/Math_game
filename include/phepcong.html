<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i: C·ªông X√∫c X·∫Øc</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&display=swap');
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f7fee7;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }
        .game-title {
            font-weight: 800;
            font-size: 2.5rem;
            color: #4d7c0f;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }
        #game-area {
            background-color: #ffffff;
            border-radius: 1.5rem;
            border: 5px solid #a3e635;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            padding: 2rem;
            max-width: 800px;
        }
        
        /* Dice Styles IMPROVED */
        .dice-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 2rem;
        }
        .die {
            width: 80px;
            height: 80px;
            background-color: #f87171; /* Brighter Red Base */
            border-radius: 12px;
            /* T·∫°o hi·ªáu ·ª©ng 3D nh·∫π */
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.3), /* Inside Shadow */
                0 6px 0 #b91c1c, /* Bottom edge */
                0 8px 10px rgba(0, 0, 0, 0.5); /* Outer shadow */
            display: grid;
            padding: 10px;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            position: relative;
            transition: transform 0.1s ease;
            transform: translateY(0);
        }
        .die:active {
            transform: translateY(3px);
            box-shadow: 
                inset 0 0 10px rgba(0, 0, 0, 0.3),
                0 3px 0 #b91c1c,
                0 5px 8px rgba(0, 0, 0, 0.3);
        }
        .pip {
            width: 10px;
            height: 10px;
            background-color: #fefefe; /* White Pips for contrast */
            border-radius: 50%;
            place-self: center;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5); /* Pip shadow */
        }
        
        /* Option Button Styles */
        .option-btn {
            background-color: #ecfccb;
            border: 3px solid #bef264;
            color: #3f6212;
            font-size: 2rem;
            font-weight: 700;
            padding: 1rem 0;
            transition: all 0.2s;
            box-shadow: 0 4px 0px #84cc16;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0px #65a30d;
        }
        .correct {
            background-color: #4ade80 !important;
            border-color: #16a34a !important;
            color: white !important;
            box-shadow: 0 4px 0px #16a34a !important;
        }
        .incorrect {
            background-color: #f87171 !important;
            border-color: #b91c1c !important;
            color: white !important;
            box-shadow: 0 4px 0px #b91c1c !important;
        }

    </style>
</head>
<body class="bg-lime-50">

    <div class="container mx-auto text-center p-4" id="game-area">
        <h1 class="game-title mb-4">C·ªông X√∫c X·∫Øc üé≤</h1>
        <p class="text-gray-600 mb-6 font-medium">B√© h√£y c·ªông t·ªïng c√°c m·∫∑t x√∫c x·∫Øc v√† ch·ªçn ƒë√°p √°n ƒë√∫ng!</p>

        <div id="settings-screen">
            <label class="block text-xl font-bold text-green-800 mb-2">Ch·ªçn s·ªë l∆∞·ª£ng x√∫c x·∫Øc (ƒê·ªô kh√≥):</label>
            <select id="num-dice-select" class="w-full sm:w-1/2 p-3 text-lg rounded-lg border-2 border-lime-400 focus:outline-none focus:ring-2 focus:ring-lime-600 mb-6">
                <option value="2">2 X√∫c x·∫Øc (D·ªÖ)</option>
                <option value="3">3 X√∫c x·∫Øc (V·ª´a)</option>
                <option value="4">4 X√∫c x·∫Øc (Kh√≥)</option>
            </select>
            <button id="start-btn" class="w-full sm:w-auto bg-green-600 text-white font-bold py-4 px-12 text-xl rounded-xl shadow-lg hover:bg-green-700 transition-colors duration-200">
                B·∫Øt ƒê·∫ßu Ch∆°i!
            </button>
        </div>

        <div id="game-screen" class="hidden">
            <p id="progress-text" class="text-lg font-bold text-green-700 mb-4">C√¢u 1</p>
            
            <div id="dice-visual-area" class="dice-container">
                </div>
            
            <p id="sum-equation" class="text-2xl font-bold text-gray-700 mb-6 h-8"></p>

            <p class="text-gray-700 mb-4 font-semibold">T·ªïng l√† bao nhi√™u?</p>
            <div id="options-container" class="grid grid-cols-4 gap-4 mb-6">
                </div>
            
            <p id="message-text" class="text-xl font-bold h-8 mb-4"></p>
            
            <button id="next-btn" class="hidden w-full sm:w-auto bg-blue-500 text-white font-bold py-3 px-10 rounded-xl shadow-md hover:bg-blue-600 transition-colors">
                C√¢u Ti·∫øp Theo ‚ûú
            </button>
        </div>
    </div>

<script>
    // --- ELEMENTS ---
    const settingsScreen = document.getElementById('settings-screen');
    const gameScreen = document.getElementById('game-screen');
    const startBtn = document.getElementById('start-btn');
    const numDiceSelect = document.getElementById('num-dice-select');
    const diceVisualArea = document.getElementById('dice-visual-area');
    const optionsContainer = document.getElementById('options-container');
    const messageText = document.getElementById('message-text');
    const nextBtn = document.getElementById('next-btn');
    const progressText = document.getElementById('progress-text');
    const sumEquationText = document.getElementById('sum-equation');

    // --- GAME STATE ---
    let numDice = 2;
    let correctSum = 0;
    let isAnswered = false;
    let currentQuestion = 1;
    const TOTAL_QUESTIONS = 10;
    
    // V·ªã tr√≠ c√°c ch·∫•m (pips) tr√™n m·∫∑t x√∫c x·∫Øc (1-6)
    const pipLayouts = {
        1: [4],
        2: [1, 7],
        3: [1, 4, 7],
        4: [0, 2, 6, 8],
        5: [0, 2, 4, 6, 8],
        6: [0, 2, 3, 5, 6, 8]
    };

    // --- LOGIC V·∫º X√öC X·∫ÆC ---
    
    function drawPips(dieElement, value) {
        const layout = pipLayouts[value];
        for (let i = 0; i < 9; i++) {
            const pip = document.createElement('div');
            pip.className = 'pip';
            if (!layout.includes(i)) {
                pip.style.visibility = 'hidden';
            }
            dieElement.appendChild(pip);
        }
    }

    function drawDice(diceValues) {
        diceVisualArea.innerHTML = '';
        sumEquationText.textContent = '';
        
        let sum = 0;
        let equation = [];
        
        diceValues.forEach(value => {
            const dieElement = document.createElement('div');
            dieElement.className = 'die';
            drawPips(dieElement, value);
            diceVisualArea.appendChild(dieElement);
            sum += value;
            equation.push(value);
        });
        
        sumEquationText.textContent = equation.join(' + ') + ' = ?';
        return sum;
    }

    // --- LOGIC T·∫†O C√ÇU H·ªéI (C·∫¢I TI·∫æN) ---

    function generateDiceRoll(n) {
        const rolls = [];
        for (let i = 0; i < n; i++) {
            // TƒÉng t√≠nh ng·∫´u nhi√™n, kh√¥ng ch·ªâ gi·ªõi h·∫°n ·ªü 1-6
            let roll = Math.floor(Math.random() * 6) + 1;
            rolls.push(roll);
        }
        
        // S·∫Øp x·∫øp l·∫°i ƒë·ªÉ ph√©p t√≠nh tr√¥ng ƒë·∫πp h∆°n
        rolls.sort((a, b) => b - a);
        return rolls;
    }

    function generateOptions(correctAnswer) {
        optionsContainer.innerHTML = '';
        const options = new Set();
        options.add(correctAnswer);
        
        const minPossible = numDice;
        const maxPossible = numDice * 6;
        
        // T·∫°o 3 ƒë√°p √°n sai ƒë·∫£m b·∫£o ƒëa d·∫°ng v√† n·∫±m trong ph·∫°m vi h·ª£p l√Ω
        while(options.size < 4) {
            let wrong = correctAnswer + Math.floor(Math.random() * 7) - 3; // Sai s·ªë t·ª´ -3 ƒë·∫øn +3
            
            // N·∫øu ƒë√°p √°n sai g·∫ßn ƒë√°p √°n ƒë√∫ng h·ª£p l·ªá
            if (wrong !== correctAnswer && wrong >= minPossible && wrong <= maxPossible) {
                options.add(wrong);
            } 
            // N·∫øu kh√¥ng th·ªÉ t·∫°o ƒë√°p √°n sai g·∫ßn, t·∫°o ƒë√°p √°n sai ng·∫´u nhi√™n trong ph·∫°m vi
            else {
                let farWrong = Math.floor(Math.random() * (maxPossible - minPossible + 1)) + minPossible;
                if (farWrong !== correctAnswer) options.add(farWrong);
            }
        }

        const optionsArray = Array.from(options).sort(() => Math.random() - 0.5);

        optionsArray.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn rounded-xl w-full';
            btn.textContent = opt;
            
            btn.onclick = () => checkAnswer(opt, btn);
            optionsContainer.appendChild(btn);
        });
    }

    // --- GAME CONTROL ---

    function setupGame() {
        numDice = parseInt(numDiceSelect.value);
        currentQuestion = 1;
        
        settingsScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        
        loadQuestion();
    }

    function loadQuestion() {
        isAnswered = false;
        
        if (currentQuestion > TOTAL_QUESTIONS) {
            finishGame();
            return;
        }
        
        progressText.textContent = `C√¢u ${currentQuestion} / ${TOTAL_QUESTIONS}`;
        messageText.textContent = '';
        messageText.className = '';
        nextBtn.classList.add('hidden');
        
        // ƒê·∫£m b·∫£o kh√¥ng th·ªÉ nh·∫•p l·∫°i n√∫t khi ƒëang load c√¢u h·ªèi m·ªõi
        optionsContainer.querySelectorAll('button').forEach(btn => btn.onclick = null);

        const rolls = generateDiceRoll(numDice);
        correctSum = drawDice(rolls);
        generateOptions(correctSum);
    }

    function checkAnswer(selectedVal, btn) {
        if (isAnswered) return;
        isAnswered = true;
        
        if (selectedVal === correctSum) {
            btn.classList.add('correct');
            messageText.textContent = "Ch√≠nh x√°c! üéâ";
            messageText.className = "text-xl font-bold text-green-600";
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ ƒë√∫ng
            sumEquationText.textContent = sumEquationText.textContent.replace('?', correctSum);
            
            nextBtn.classList.remove('hidden');
        } else {
            btn.classList.add('incorrect');
            messageText.textContent = "Sai r·ªìi. T·ªïng ƒë√∫ng l√† " + correctSum + ".";
            messageText.className = "text-xl font-bold text-red-500";
            
            // Highlight ƒë√°p √°n ƒë√∫ng
            optionsContainer.querySelectorAll('button').forEach(b => {
                if (parseInt(b.textContent) === correctSum) {
                    setTimeout(() => b.classList.add('correct'), 300);
                }
            });
            
            // Hi·ªÉn th·ªã k·∫øt qu·∫£ ƒë√∫ng
            sumEquationText.textContent = sumEquationText.textContent.replace('?', correctSum);

            setTimeout(() => {
               nextBtn.classList.remove('hidden');
            }, 1000);
        }
    }

    function finishGame() {
        gameScreen.classList.add('hidden');
        settingsScreen.classList.remove('hidden');
        alert("Ho√†n th√†nh 10 c√¢u h·ªèi! Th·ª≠ ƒë·ªô kh√≥ kh√°c nh√©! üåü");
    }

    startBtn.addEventListener('click', setupGame);
    nextBtn.addEventListener('click', () => {
        currentQuestion++;
        loadQuestion();
    });
    
</script>
</body>
</html>