<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i: B√© T·∫≠p Xem L·ªãch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800&display=swap');
        
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f0f9ff; /* Xanh d∆∞∆°ng nh·∫°t */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 0.5rem;
        }

        .game-title {
            font-weight: 800;
            font-size: 1.8rem;
            color: #0369a1; /* Xanh d∆∞∆°ng ƒë·∫≠m */
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }

        /* CSS cho t·ªù l·ªãch */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            padding: 8px;
            background: white;
            border-radius: 0 0 12px 12px;
            border: 2px solid #bae6fd;
            border-top: none;
        }

        .cal-header {
            background-color: #0ea5e9;
            color: white;
            border-radius: 12px 12px 0 0;
            padding: 8px;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 800;
            font-size: 0.9rem;
        }

        .day-cell {
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            font-weight: 700;
            color: #475569;
            font-size: 1.1rem;
            cursor: default;
            transition: all 0.2s;
        }

        .day-empty {
            background: transparent;
        }

        /* Ng√†y hi·ªán t·∫°i (H√¥m nay) */
        .day-start {
            background-color: #fb923c !important; /* Cam */
            color: white !important;
            box-shadow: 0 2px 0 #c2410c;
            transform: scale(1.1);
            z-index: 10;
            border: 2px solid white;
        }

        /* Ng√†y k·∫øt qu·∫£ (Sau khi t√≠nh xong) */
        .day-target {
            background-color: #22c55e !important; /* Xanh l√° */
            color: white !important;
            animation: pulse-green 1s infinite;
        }
        
        /* Hi·ªáu ·ª©ng ƒë·∫øm (ƒë·ªÉ b√© nh√¨n ƒë∆∞·ªùng ƒëi - tu·ª≥ ch·ªçn) */
        .day-path {
            background-color: #fed7aa;
            color: #9a3412;
        }

        .option-btn {
            background-color: white;
            border: 2px solid #e0f2fe;
            color: #0369a1;
            font-weight: 700;
            padding: 10px 4px;
            border-radius: 8px;
            transition: all 0.2s;
            box-shadow: 0 3px 0 #bae6fd;
            font-size: 0.95rem;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            background-color: #f0f9ff;
        }
        .option-btn:active {
            transform: translateY(1px);
            box-shadow: 0 1px 0 #bae6fd;
        }

        .btn-correct {
            background-color: #22c55e !important;
            border-color: #15803d !important;
            color: white !important;
            box-shadow: 0 3px 0 #15803d !important;
        }
        .btn-incorrect {
            background-color: #ef4444 !important;
            border-color: #b91c1c !important;
            color: white !important;
            box-shadow: 0 3px 0 #b91c1c !important;
            animation: shake 0.4s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
    </style>
</head>
<body class="bg-sky-50">

    <div class="container mx-auto max-w-xl text-center p-4 bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border-4 border-white">
        <h1 class="game-title mb-1">Xem L·ªãch: Th·ª© M·∫•y?</h1>
        <p class="text-gray-500 mb-4 text-sm font-medium">B√© h√£y nh√¨n l·ªãch v√† tr·∫£ l·ªùi c√¢u h·ªèi nh√©!</p>

        <div id="settings-screen">
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-bold text-sky-800 mb-1">ƒê·ªô kh√≥</label>
                    <select id="difficulty-select" class="w-full p-2 border-2 border-sky-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-400 text-sky-900 font-bold">
                        <option value="easy">D·ªÖ (C·ªông 1-6 ng√†y)</option>
                        <option value="medium">V·ª´a (C·ªông 7-14 ng√†y)</option>
                        <option value="hard">Kh√≥ (C·ªông 15-25 ng√†y)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold text-sky-800 mb-1">S·ªë c√¢u</label>
                    <select id="num-questions-select" class="w-full p-2 border-2 border-sky-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-400 text-sky-900 font-bold">
                        <option value="5">5 c√¢u</option>
                        <option value="10">10 c√¢u</option>
                    </select>
                </div>
            </div>
            <button id="start-btn" class="w-full bg-sky-500 text-white font-bold py-3 px-8 text-lg rounded-xl shadow-md hover:bg-sky-600 transition-colors duration-200">
                B·∫Øt ƒê·∫ßu Ch∆°i!
            </button>
        </div>

        <div id="game-screen" class="hidden">
            <div class="flex justify-between items-center px-2 mb-3">
                <span id="progress-text" class="text-sky-600 font-bold text-base">C√¢u 1/10</span>
                <div class="flex gap-1">
                    <span class="w-2.5 h-2.5 rounded-full bg-red-400"></span>
                    <span class="w-2.5 h-2.5 rounded-full bg-yellow-400"></span>
                    <span class="w-2.5 h-2.5 rounded-full bg-green-400"></span>
                </div>
            </div>

            <div class="bg-orange-50 border-2 border-orange-200 rounded-xl p-3 mb-4">
                <p id="question-text" class="text-lg font-bold text-orange-800 leading-snug">
                    H√¥m nay l√† <span class="text-orange-600">Th·ª© 2</span> (ng√†y 10).<br>
                    <span class="text-2xl text-orange-600">4</span> ng√†y n·ªØa l√† th·ª© m·∫•y?
                </p>
            </div>

            <div class="mb-6 max-w-[360px] mx-auto shadow-lg">
                <div class="cal-header">
                    <div>T2</div><div>T3</div><div>T4</div><div>T5</div><div>T6</div><div class="text-yellow-200">T7</div><div class="text-red-200">CN</div>
                </div>
                <div id="calendar-grid" class="calendar-grid">
                    </div>
            </div>
            
            <p class="text-gray-500 text-xs font-bold mb-2 text-left px-2">Ch·ªçn ƒë√°p √°n:</p>
            <div id="options-container" class="grid grid-cols-4 gap-2 mb-4">
                </div>
            
            <div id="message" class="h-8 flex items-center justify-center rounded-lg mb-1">
                <p id="message-text" class="text-lg font-bold"></p>
            </div>
            
            <button id="next-btn" class="hidden w-full bg-sky-500 text-white font-bold py-2 px-8 rounded-lg shadow-md hover:bg-sky-600 transition-colors">
                C√¢u Ti·∫øp Theo ‚ûú
            </button>
        </div>
    </div>

<script>
    // --- DATA ---
    const daysOfWeek = ['CN', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7']; // Index 0 = CN
    
    // --- ELEMENTS ---
    const settingsScreen = document.getElementById('settings-screen');
    const gameScreen = document.getElementById('game-screen');
    const startBtn = document.getElementById('start-btn');
    const difficultySelect = document.getElementById('difficulty-select');
    const numQuestionsSelect = document.getElementById('num-questions-select');
    
    const questionText = document.getElementById('question-text');
    const calendarGrid = document.getElementById('calendar-grid');
    const optionsContainer = document.getElementById('options-container');
    const messageText = document.getElementById('message-text');
    const nextBtn = document.getElementById('next-btn');
    const progressText = document.getElementById('progress-text');

    // --- GAME STATE ---
    let currentQuestionIndex = 0;
    let gameQuestions = [];
    let isAnswered = false;
    let currentDifficulty = 'easy';
    let currentQ = null;

    // --- LOGIC ---

    // H√†m l·∫•y s·ªë ng√†y trong th√°ng (gi·∫£ l·∫≠p ƒë∆°n gi·∫£n ƒë·ªÉ b√© d·ªÖ h·ªçc)
    // Ta s·∫Ω d√πng th√°ng c·ªë ƒë·ªãnh 31 ng√†y ho·∫∑c 30 ng√†y ng·∫´u nhi√™n
    function generateQuestions(count, difficulty) {
        const questions = [];
        let minAdd = 1, maxAdd = 6;
        
        if(difficulty === 'medium') { minAdd = 7; maxAdd = 14; }
        if(difficulty === 'hard') { minAdd = 15; maxAdd = 25; }

        for(let i=0; i<count; i++) {
            // 1. Ch·ªçn ng√†y b·∫Øt ƒë·∫ßu ng·∫´u nhi√™n c·ªßa th√°ng (1 -> 28 ƒë·ªÉ ƒë·∫£m b·∫£o ph√©p c·ªông k qu√° ph·ª©c t·∫°p ·ªü m·ª©c d·ªÖ)
            // ƒê·ªÉ tr·ª±c quan, ta gi·∫£ ƒë·ªãnh th√°ng n√†y b·∫Øt ƒë·∫ßu v√†o m·ªôt th·ª© ng·∫´u nhi√™n
            const monthStartDayOfWeek = Math.floor(Math.random() * 7); // 0(CN) -> 6(T7)
            
            // 2. Ch·ªçn ng√†y hi·ªán t·∫°i (startDate)
            // Gi·ªõi h·∫°n startDate sao cho startDate + daysToAdd kh√¥ng v∆∞·ª£t qu√° 30 qu√° nhi·ªÅu
            // ƒë·ªÉ hi·ªÉn th·ªã tr√™n 1 t·ªù l·ªãch cho ƒë·∫πp (ho·∫∑c ch·ªõm sang th√°ng sau c≈©ng ƒë∆∞·ª£c, nh∆∞ng ƒë·ªÉ d·ªÖ th√¨ gi·ªØ trong 1 trang)
            let maxStart = 25;
            if(difficulty === 'hard') maxStart = 5; // N·∫øu c·ªông nhi·ªÅu ng√†y th√¨ start ph·∫£i nh·ªè
            else if(difficulty === 'medium') maxStart = 15;
            
            const startDate = Math.floor(Math.random() * maxStart) + 1;
            
            // 3. S·ªë ng√†y c·ªông th√™m
            const daysToAdd = Math.floor(Math.random() * (maxAdd - minAdd + 1)) + minAdd;
            
            // 4. T√≠nh to√°n
            // T√¨m th·ª© c·ªßa ng√†y 1: monthStartDayOfWeek
            // Th·ª© c·ªßa ng√†y startDate:
            // Index th·ª© = (monthStartDayOfWeek + (startDate - 1)) % 7
            const startDayIndex = (monthStartDayOfWeek + (startDate - 1)) % 7;
            
            const targetDate = startDate + daysToAdd;
            const targetDayIndex = (startDayIndex + daysToAdd) % 7;

            questions.push({
                monthStartDayOfWeek, // Ng√†y 1 c·ªßa th√°ng r∆°i v√†o th·ª© m·∫•y
                startDate,           // Ng√†y h√¥m nay (s·ªë)
                startDayIndex,       // Ng√†y h√¥m nay (th·ª© index)
                daysToAdd,           // C·ªông th√™m bao nhi√™u
                targetDate,          // Ng√†y k·∫øt qu·∫£ (s·ªë)
                targetDayIndex       // Ng√†y k·∫øt qu·∫£ (th·ª© index)
            });
        }
        return questions;
    }

    // --- VIEW FUNCTIONS ---

    function renderCalendar(q) {
        calendarGrid.innerHTML = '';
        
        // T·∫°o c√°c √¥ tr·ªëng tr∆∞·ªõc ng√†y 1
        // L∆∞u √Ω: L·ªãch hi·ªÉn th·ªã T2, T3... T7, CN. 
        // Logic m·∫£ng daysOfWeek: 0=CN, 1=T2... 6=T7.
        // Tr√™n giao di·ªán Grid: C·ªôt 1=T2, C·ªôt 2=T3... C·ªôt 6=T7, C·ªôt 7=CN.
        
        // Map index JS sang c·ªôt Grid (1-7):
        // JS: 1(T2)->1, 2(T3)->2, ..., 6(T7)->6, 0(CN)->7
        let startColumn = q.monthStartDayOfWeek === 0 ? 7 : q.monthStartDayOfWeek;
        
        // Loop t·∫°o √¥ tr·ªëng
        for(let i=1; i<startColumn; i++) {
            const empty = document.createElement('div');
            empty.className = 'day-cell day-empty';
            calendarGrid.appendChild(empty);
        }

        // Loop t·∫°o ng√†y (V·∫Ω ƒë·∫øn ng√†y 31 cho ƒë·∫ßy ƒë·∫∑n)
        for(let d=1; d<=31; d++) {
            const cell = document.createElement('div');
            cell.className = 'day-cell bg-slate-50 border border-slate-100';
            cell.textContent = d;
            
            // Highlight ng√†y b·∫Øt ƒë·∫ßu (H√¥m nay)
            if(d === q.startDate) {
                cell.classList.add('day-start');
                cell.innerHTML = `<span>${d}</span>`; // B·ªçc span ƒë·ªÉ style
            }
            
            // ƒê√°nh d·∫•u ID ƒë·ªÉ t√¨m ng√†y ƒë√≠ch sau khi tr·∫£ l·ªùi ƒë√∫ng
            cell.id = `date-${d}`;

            calendarGrid.appendChild(cell);
        }
    }

    function renderOptions(correctIndex) {
        optionsContainer.innerHTML = '';
        // Hi·ªÉn th·ªã ƒë·ªß 7 th·ª© nh∆∞ng x√°o tr·ªôn ho·∫∑c c·ªë ƒë·ªãnh? 
        // ƒê·ªÉ d·ªÖ t√¨m, n√™n hi·ªÉn th·ªã c·ªë ƒë·ªãnh t·ª´ T2 -> CN
        const order = [1, 2, 3, 4, 5, 6, 0]; // T2 -> CN
        
        order.forEach(idx => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = daysOfWeek[idx];
            btn.onclick = () => checkAnswer(idx, btn);
            optionsContainer.appendChild(btn);
        });
    }

    // --- CONTROLLER ---

    function setupGame() {
        const diff = difficultySelect.value;
        const num = parseInt(numQuestionsSelect.value);
        currentDifficulty = diff;
        
        gameQuestions = generateQuestions(num, diff);
        currentQuestionIndex = 0;
        
        settingsScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        
        loadQuestion();
    }

    function loadQuestion() {
        isAnswered = false;
        if (currentQuestionIndex >= gameQuestions.length) {
            finishGame();
            return;
        }
        
        currentQ = gameQuestions[currentQuestionIndex];
        progressText.textContent = `C√¢u ${currentQuestionIndex + 1} / ${gameQuestions.length}`;
        messageText.textContent = '';
        nextBtn.classList.add('hidden');
        
        // C·∫≠p nh·∫≠t text c√¢u h·ªèi
        const dayName = daysOfWeek[currentQ.startDayIndex];
        questionText.innerHTML = `
            H√¥m nay l√† <span class="text-orange-600 font-extrabold">${dayName}</span> (ng√†y ${currentQ.startDate}).<br>
            <span class="text-2xl text-orange-600 font-extrabold">${currentQ.daysToAdd}</span> ng√†y n·ªØa l√† th·ª© m·∫•y?
        `;

        renderCalendar(currentQ);
        renderOptions(currentQ.targetDayIndex);
    }

    function checkAnswer(selectedIndex, btn) {
        if(isAnswered) return;
        isAnswered = true;
        
        const isCorrect = selectedIndex === currentQ.targetDayIndex;
        
        if(isCorrect) {
            btn.classList.add('btn-correct');
            messageText.textContent = "Gi·ªèi qu√°! ƒê√∫ng r·ªìi! üéâ";
            messageText.className = "text-green-600 text-lg font-bold";
            
            // Visual effect: Highlight ng√†y ƒë√≠ch tr√™n l·ªãch
            const targetCell = document.getElementById(`date-${currentQ.targetDate}`);
            if(targetCell) {
                targetCell.classList.add('day-target');
                // Cu·ªôn nh·∫π n·∫øu c·∫ßn (nh∆∞ng ·ªü layout n√†y th√¨ kh√¥ng c·∫ßn)
            }
            
            nextBtn.classList.remove('hidden');
        } else {
            btn.classList.add('btn-incorrect');
            const correctName = daysOfWeek[currentQ.targetDayIndex];
            messageText.textContent = `Sai r·ªìi, ƒë√≥ l√† ${correctName} m·ªõi ƒë√∫ng! üòÖ`;
            messageText.className = "text-red-500 text-lg font-bold";
            
            // Highlight ƒë√°p √°n ƒë√∫ng tr√™n n√∫t
            const allBtns = optionsContainer.querySelectorAll('button');
            allBtns.forEach(b => {
                if(b.textContent === correctName) {
                    setTimeout(() => b.classList.add('btn-correct'), 300);
                }
            });
            
            // Highlight tr√™n l·ªãch lu√¥n ƒë·ªÉ b√© h·ªçc
            const targetCell = document.getElementById(`date-${currentQ.targetDate}`);
            if(targetCell) targetCell.classList.add('day-target');

            setTimeout(() => nextBtn.classList.remove('hidden'), 1500);
        }
    }

    function finishGame() {
        gameScreen.classList.add('hidden');
        settingsScreen.classList.remove('hidden');
        alert("Ch√∫c m·ª´ng b√© ƒë√£ ho√†n th√†nh b√†i t·∫≠p xem l·ªãch! üåü");
    }

    startBtn.addEventListener('click', setupGame);
    nextBtn.addEventListener('click', () => {
        currentQuestionIndex++;
        loadQuestion();
    });

</script>
</body>
</html>