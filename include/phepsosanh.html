<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr√≤ ch∆°i: So S√°nh S·ªë</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nunito:wght@700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ecfdf5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 0.5rem; /* Gi·∫£m padding body */
        }
        .game-title {
            font-family: 'Nunito', sans-serif;
            font-weight: 800;
            font-size: 1.8rem; /* Gi·∫£m font ti√™u ƒë·ªÅ */
            color: #059669;
            text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 0px #e5e7eb; /* Gi·∫£m b√≥ng ƒë·ªï */
            font-family: 'Nunito', sans-serif;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0px #d1d5db;
        }
        .option-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0px #d1d5db;
        }
        .correct {
            background-color: #22c55e !important;
            border-color: #15803d !important;
            color: white !important;
            box-shadow: 0 4px 0px #15803d !important;
            animation: pulse 0.5s;
        }
        .incorrect {
            background-color: #ef4444 !important;
            border-color: #b91c1c !important;
            color: white !important;
            box-shadow: 0 4px 0px #b91c1c !important;
            animation: shake 0.5s;
        }
        #gameCanvas {
            background-color: #ffffff;
            border-radius: 0.75rem;
            border: 3px solid #6ee7b7;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .custom-select {
            background-color: white;
            border: 2px solid #34d399;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body class="bg-emerald-50">

    <div class="container mx-auto max-w-xl text-center p-4 bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl border-4 border-white">
        <h1 class="game-title mb-1">So S√°nh S·ªë</h1>
        <p class="text-gray-500 mb-4 text-sm font-medium">B√© h√£y ch·ªçn d·∫•u L·ªõn, B√© ho·∫∑c B·∫±ng nh√©!</p>

        <div id="settings-screen">
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-bold text-emerald-800 mb-1">ƒê·ªô kh√≥</label>
                    <select id="difficulty-select" class="custom-select w-full p-2 text-base rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-400">
                        <option value="easy">D·ªÖ (ƒê·∫øn 10)</option>
                        <option value="medium">V·ª´a (ƒê·∫øn 20)</option>
                        <option value="hard">Kh√≥ (ƒê·∫øn 50)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold text-emerald-800 mb-1">S·ªë c√¢u</label>
                    <select id="num-questions-select" class="custom-select w-full p-2 text-base rounded-lg focus:outline-none focus:ring-2 focus:ring-emerald-400">
                        <option value="5">5 c√¢u</option>
                        <option value="10">10 c√¢u</option>
                        <option value="15">15 c√¢u</option>
                    </select>
                </div>
            </div>
            <button id="start-btn" class="w-full bg-emerald-500 text-white font-bold py-3 px-8 text-lg rounded-xl shadow-md hover:bg-emerald-600 transition-colors duration-200">
                B·∫Øt ƒê·∫ßu Ch∆°i!
            </button>
        </div>

        <div id="game-screen" class="hidden">
            <div class="flex justify-between items-center px-2 mb-2">
                <span id="progress-text" class="text-emerald-600 font-bold text-base">C√¢u 1/10</span>
                <div class="flex gap-1">
                    <span class="w-2.5 h-2.5 rounded-full bg-red-400"></span>
                    <span class="w-2.5 h-2.5 rounded-full bg-yellow-400"></span>
                    <span class="w-2.5 h-2.5 rounded-full bg-green-400"></span>
                </div>
            </div>
            
            <canvas id="gameCanvas" width="460" height="280" class="mx-auto mb-4 w-full max-w-[460px]"></canvas>
            
            <p class="text-gray-600 mb-3 text-sm font-semibold">Ch·ªçn d·∫•u th√≠ch h·ª£p:</p>
            
            <div id="options-container" class="flex justify-center gap-4 mb-4">
                <button id="btn-greater" class="option-btn w-20 h-20 bg-white border-4 border-orange-300 text-orange-500 text-4xl rounded-xl" onclick="checkAnswer('>')">&gt;</button>
                <button id="btn-equal" class="option-btn w-20 h-20 bg-white border-4 border-blue-300 text-blue-500 text-4xl rounded-xl" onclick="checkAnswer('=')">=</button>
                <button id="btn-less" class="option-btn w-20 h-20 bg-white border-4 border-purple-300 text-purple-500 text-4xl rounded-xl" onclick="checkAnswer('<')">&lt;</button>
            </div>
            
            <div id="message" class="h-8 flex items-center justify-center rounded-lg mb-1">
                <p id="message-text" class="text-lg font-bold"></p>
            </div>
            
            <button id="next-btn" class="hidden w-full sm:w-auto bg-blue-500 text-white font-bold py-2 px-8 rounded-lg shadow-md hover:bg-blue-600 transition-colors">
                Ti·∫øp Theo ‚ûú
            </button>
        </div>
    </div>

<script>
    // --- ELEMENTS ---
    const settingsScreen = document.getElementById('settings-screen');
    const gameScreen = document.getElementById('game-screen');
    const startBtn = document.getElementById('start-btn');
    const difficultySelect = document.getElementById('difficulty-select');
    const numQuestionsSelect = document.getElementById('num-questions-select');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const messageText = document.getElementById('message-text');
    const nextBtn = document.getElementById('next-btn');
    const progressText = document.getElementById('progress-text');
    
    const btnGreater = document.getElementById('btn-greater');
    const btnEqual = document.getElementById('btn-equal');
    const btnLess = document.getElementById('btn-less');
    const buttons = [btnGreater, btnEqual, btnLess];

    // --- GAME STATE ---
    let currentQuestionIndex = 0;
    let gameQuestions = [];
    let isAnswered = false;
    let currentDifficulty = 'easy';

    // --- LOGIC ---
    function generateQuestions(count, difficulty) {
        const questions = [];
        let maxNumber = 10;
        if (difficulty === 'medium') maxNumber = 20;
        if (difficulty === 'hard') maxNumber = 50;

        for (let i = 0; i < count; i++) {
            let num1 = Math.floor(Math.random() * maxNumber) + 1;
            let num2 = Math.floor(Math.random() * maxNumber) + 1;

            if (Math.random() < 0.3) num2 = num1;

            let correctAnswer;
            if (num1 > num2) correctAnswer = '>';
            else if (num1 < num2) correctAnswer = '<';
            else correctAnswer = '=';

            questions.push({num1, num2, correctAnswer});
        }
        return questions;
    }

    // --- H√ÄM V·∫º (ƒê√£ tinh ch·ªânh k√≠ch th∆∞·ªõc) ---

    function drawCube3D(ctx, x, y, size, color) {
        ctx.fillStyle = color;
        ctx.fillRect(x, y, size, size);
        
        ctx.fillStyle = 'rgba(0,0,0,0.2)';
        ctx.fillRect(x + size, y + 2, 3, size - 2); // B√≥ng nh·ªè h∆°n
        ctx.fillRect(x + 2, y + size, size - 2, 3); 
        
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.beginPath();
        ctx.arc(x + size/2, y + size/2, size/4, 0, Math.PI*2);
        ctx.fill();
    }

    function drawGroup(ctx, x, y, count, color) {
        if (count === 0) return;
        // GI·∫¢M K√çCH TH∆Ø·ªöC KH·ªêI
        const size = 18; 
        const gap = 4;   
        const maxCols = 5; 
        
        const rows = Math.ceil(count / maxCols);
        const totalH = rows * size + (rows - 1) * gap;
        const startY = y - totalH; 

        let countDrawn = 0;
        for(let r = 0; r < rows; r++) {
            let colsInRow = (count - countDrawn >= maxCols) ? maxCols : (count - countDrawn);
            let rowW = colsInRow * size + (colsInRow - 1) * gap;
            let startX = x - rowW / 2;

            for(let c = 0; c < colsInRow; c++) {
                drawCube3D(ctx, startX + c*(size+gap), startY + r*(size+gap), size, color);
                countDrawn++;
            }
        }
    }

    function drawCircleNumber(ctx, x, y, value, color, scale = 1) {
        // GI·∫¢M SIZE V√íNG TR√íN
        const radius = 32 * scale; 
        
        ctx.beginPath();
        ctx.arc(x, y, radius, 0, Math.PI * 2);
        ctx.fillStyle = '#ffffff';
        ctx.fill();
        
        ctx.lineWidth = 3 * scale;
        ctx.strokeStyle = color;
        ctx.stroke();
        
        ctx.fillStyle = color;
        // GI·∫¢M FONT SIZE S·ªê
        ctx.font = `bold ${36 * scale}px "Nunito"`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(value, x, y + (3 * scale));
    }

    function drawScene() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        const q = gameQuestions[currentQuestionIndex];

        const w = canvas.width;
        const h = canvas.height;
        const centerX = w / 2;
        const centerY = h / 2;
        
        // S·ª¨ D·ª§NG T·ªåA ƒê·ªò T∆Ø∆†NG ƒê·ªêI (Responsive logic)
        const leftX = w * 0.25;  // 25% chi·ªÅu r·ªông
        const rightX = w * 0.75; // 75% chi·ªÅu r·ªông

        const colorLeft = '#ea580c'; 
        const colorRight = '#2563eb'; 

        if (currentDifficulty !== 'hard') {
            // D·ªÖ/V·ª´a
            const blockY = h * 0.65; // H√¨nh kh·ªëi k·∫øt th√∫c ·ªü 65% chi·ªÅu cao
            const circleY = h * 0.85; // V√≤ng tr√≤n s·ªë ·ªü 85% chi·ªÅu cao
            
            drawGroup(ctx, leftX, blockY, q.num1, '#fb923c'); 
            drawGroup(ctx, rightX, blockY, q.num2, '#60a5fa');
            
            drawCircleNumber(ctx, leftX, circleY, q.num1, colorLeft, 0.9);
            drawCircleNumber(ctx, rightX, circleY, q.num2, colorRight, 0.9);
            
            // D·∫•u h·ªèi ch·∫•m
            drawQuestionBox(ctx, centerX, circleY);
            
        } else {
            // Kh√≥: ƒê·∫©y s·ªë l√™n gi·ªØa
            drawCircleNumber(ctx, leftX, centerY, q.num1, colorLeft, 1.1);
            drawCircleNumber(ctx, rightX, centerY, q.num2, colorRight, 1.1);
            
            // D·∫•u h·ªèi ch·∫•m ·ªü gi·ªØa
            drawQuestionBox(ctx, centerX, centerY);
        }
    }
    
    function drawQuestionBox(ctx, x, y) {
        ctx.strokeStyle = '#d1d5db';
        ctx.lineWidth = 3;
        ctx.setLineDash([8, 8]);
        // H·ªôp h·ªèi ch·∫•m nh·ªè h∆°n (60x60)
        ctx.strokeRect(x - 30, y - 30, 60, 60);
        ctx.setLineDash([]);
        
        ctx.fillStyle = '#9ca3af';
        ctx.font = 'bold 32px "Nunito"';
        ctx.fillText("?", x, y);
    }

    function drawResultInCenter(resultSymbol) {
        const w = canvas.width;
        const h = canvas.height;
        
        // T√≠nh to√°n l·∫°i v·ªã tr√≠ y d·ª±a tr√™n ƒë·ªô kh√≥
        let targetY;
        if (currentDifficulty === 'hard') {
            targetY = h / 2;
        } else {
            targetY = h * 0.85;
        }

        // X√≥a √¥ h·ªèi ch·∫•m c≈©
        ctx.fillStyle = '#ffffff';
        ctx.fillRect((w/2) - 28, targetY - 28, 56, 56);
        
        // V·∫Ω k·∫øt qu·∫£
        ctx.fillStyle = '#059669';
        ctx.font = 'bold 48px "Nunito"';
        ctx.fillText(resultSymbol, w/2, targetY + 4);
    }

    // --- CONTROLS (Gi·ªØ nguy√™n logic) ---

    function setupGame() {
        const diff = difficultySelect.value;
        const num = parseInt(numQuestionsSelect.value);
        currentDifficulty = diff;
        gameQuestions = generateQuestions(num, diff);
        currentQuestionIndex = 0;
        settingsScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        loadQuestion();
    }

    function resetButtons() {
        buttons.forEach(btn => {
            // C·∫≠p nh·∫≠t class cho n√∫t nh·ªè h∆°n
            btn.className = 'option-btn w-20 h-20 bg-white border-4 text-4xl rounded-xl';
            if(btn.id === 'btn-greater') btn.classList.add('border-orange-300', 'text-orange-500');
            if(btn.id === 'btn-equal') btn.classList.add('border-blue-300', 'text-blue-500');
            if(btn.id === 'btn-less') btn.classList.add('border-purple-300', 'text-purple-500');
        });
    }

    function loadQuestion() {
        isAnswered = false;
        if (currentQuestionIndex >= gameQuestions.length) {
            finishGame();
            return;
        }
        progressText.textContent = `C√¢u ${currentQuestionIndex + 1} / ${gameQuestions.length}`;
        messageText.textContent = '';
        nextBtn.classList.add('hidden');
        resetButtons();
        drawScene();
    }

    function checkAnswer(selectedVal) {
        if (isAnswered) return;
        isAnswered = true;
        
        const q = gameQuestions[currentQuestionIndex];
        const isCorrect = selectedVal === q.correctAnswer;
        
        let selectedBtn;
        if(selectedVal === '>') selectedBtn = btnGreater;
        else if(selectedVal === '=') selectedBtn = btnEqual;
        else selectedBtn = btnLess;

        if (isCorrect) {
            selectedBtn.classList.remove('border-orange-300','border-blue-300','border-purple-300');
            selectedBtn.classList.add('correct');
            messageText.textContent = "Ch√≠nh x√°c! üéâ";
            messageText.className = "text-lg font-bold text-green-600";
            drawResultInCenter(q.correctAnswer);
            nextBtn.classList.remove('hidden');
        } else {
            selectedBtn.classList.remove('border-orange-300','border-blue-300','border-purple-300');
            selectedBtn.classList.add('incorrect');
            messageText.textContent = "ƒê√°p √°n l√† " + q.correctAnswer + " nh√©! üòÖ";
            messageText.className = "text-lg font-bold text-red-500";
            
            let correctBtn;
            if(q.correctAnswer === '>') correctBtn = btnGreater;
            else if(q.correctAnswer === '=') correctBtn = btnEqual;
            else correctBtn = btnLess;
            
            setTimeout(() => {
                correctBtn.classList.remove('border-orange-300','border-blue-300','border-purple-300');
                correctBtn.classList.add('correct');
                drawResultInCenter(q.correctAnswer);
            }, 500);
            setTimeout(() => nextBtn.classList.remove('hidden'), 1200);
        }
    }

    function finishGame() {
        gameScreen.classList.add('hidden');
        settingsScreen.classList.remove('hidden');
        alert("Ch√∫c m·ª´ng b√© ƒë√£ ho√†n th√†nh! üåü");
    }

    startBtn.addEventListener('click', setupGame);
    nextBtn.addEventListener('click', () => {
        currentQuestionIndex++;
        loadQuestion();
    });
    window.addEventListener('resize', () => {
        if(!gameScreen.classList.contains('hidden')) drawScene();
    });

</script>
</body>
</html>